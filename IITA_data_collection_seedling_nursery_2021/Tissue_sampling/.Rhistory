snp.stats = cand.stats4 #copy dataframes to new names
top.candidates = top.ordered$candidate
top.snps=top.candidates
top.snp.stats = top.ordered
# redo ranges around top snps to make sure they aren't overlapping
snp.stats$CAND <- NA
snp.stats$RANGE <- NA
for (i in 1:length(top.snps)) {
snp.stats$CAND[grep(top.snps[i], snp.stats$POS)] <- top.snps[i]
}
for (i in 1:length(snp.stats$CAND)) {
if(!is.na(snp.stats$CAND[i])){snp.stats$RANGE[i] <- 0 }
}
cand.pos <- which(snp.stats$RANGE == 0)
for (i in 1:length(cand.pos)) {
snp.stats$RANGE[(cand.pos[i]-50):(cand.pos[i]+50)] <- seq(from=-50, to=50)
}
#Initiate columns for IUPAC consensus sequences
top.snp.stats$seq <- NA
top.snp.stats$IUPAC <- NA
snp.stats$problem <- NA
#Flag indels - will fix these manually
snp.stats$problem[which(nchar(snp.stats$REF) != 1)] <- "y"
#remove commas from ALT string so multiple alt alleles get included in IUPAC
snp.stats$ALT_collapse <- sub(pattern=",", replacement="", x=snp.stats$ALT)
#make a column for the nucleotide sequence
for (i in 1:nrow(snp.stats)) {
if (!is.na(snp.stats[i, "ALT"])) {
#wherever there is an alt allele, paste the ref & alt alleles together in the seq column
snp.stats[i, "seq"] <- paste(c(snp.stats[i, "REF"], snp.stats[i, "ALT_collapse"]), collapse="")
#if there is no alt allele, just put the ref allele in the seq column
} else {
snp.stats[i, "seq"] <- snp.stats[i, "REF"]
}
# make a consensus sequence with bma()
snp.stats$IUPAC[i] <- bma(unlist(strsplit(snp.stats$seq[i], split="")))
}
#capitalize the consensus
snp.stats$IUPAC <- toupper(snp.stats$IUPAC)
#add a bracket around the candidate SNP
snp.stats$IUPAC <- with(snp.stats, ifelse(!is.na(snp.stats$CAND), paste0("[", REF, "/",ALT_collapse,"]"), IUPAC))
#flag the indel sites
snp.stats$IUPAC <-with(snp.stats, ifelse(nchar(snp.stats$REF) != 1 , paste0("*(", REF, ")"), IUPAC))
#lowercase for low quality sites
snp.stats$IUPAC <- with(snp.stats, ifelse(snp.stats$DP_SUM_glaz < 10 | snp.stats$DP_SUM < 600, tolower(IUPAC), IUPAC))
write.csv(snp.stats, "~/Desktop/Research/Glaziovii_introgression/chr4.top.snp.stats.IUPAC.csv")
consensus_seqlist = list() # initiate list
for (i in 1:length(top.candidates)) {
this.cand.name <- top.candidates[i]
row.with.cand <- which(grepl(top.candidates[i], snp.stats$CAND))
this.cand  <- snp.stats[(row.with.cand-50):(row.with.cand+50),]
this.cand <- this.cand[,c(1:4,334:340)]
#select POS, REF, ALT, QUAL, RANGE, seq, IUPAC,
this.cand.df <- data.frame("POS"=this.cand$POS,
"Range"=this.cand$RANGE,
"REF"=this.cand$REF,
"ALT"=this.cand$ALT,
"seq" = this.cand$seq,
"IUPAC" = this.cand$IUPAC)
consensus.seq <- paste(this.cand.df$IUPAC, collapse="")
consensus_seqlist[[i]] <- consensus.seq # add it to the main list
names(consensus_seqlist[[i]]) <- top.candidates[i]
}
folder <- "~/Desktop/Research/Glaziovii_introgression/chromosome_4/candidate_consensus_seqs_chr4/"
all.cand.seq.df <- data.frame(matrix(ncol = 2, nrow = 38))
names(all.cand.seq.df) <- c("candidate","consensus")
for (i in 1:length(consensus_seqlist)) {
filepath <- paste(folder, names(consensus_seqlist[[i]]), '.txt', sep="")
write.table(consensus_seqlist[[i]], filepath, sep="\n")
all.cand.seq.df[i,2] <- consensus_seqlist[[i]]
all.cand.seq.df[i,1] <- names(consensus_seqlist[[i]])
}
write.csv(all.cand.seq.df, paste0(folder,"chr4.topcandidate.consensus.csv"))
REF.ALT.list <- snp.stats[which(!is.na(snp.stats$CAND)), c(2:3, 333)]
#select REF, ALT, CAND
all.cand.seq.alleles = merge(all.cand.seq.df, REF.ALT.list, by.x="candidate", by.y="CAND")
colnames(all.cand.seq.alleles)[1] <- "v7_position"
write.csv(all.cand.seq.alleles, paste0(folder,"chr4.topcandidate.consensus.csv"))
head(top.candidates)
all.cand.seq.df
all.cand.seq.alleles
top.candidates
consensus_seqlist
length(consensus_seqlist)
consensus_seqlist = list() # initiate list
for (i in 1:length(top.candidates)) {
this.cand.name <- top.candidates[i]
row.with.cand <- which(grepl(top.candidates[i], snp.stats$CAND))
this.cand  <- snp.stats[(row.with.cand-50):(row.with.cand+50),]
this.cand <- this.cand[,c(1:4,334:340)]
#select POS, REF, ALT, QUAL, RANGE, seq, IUPAC,
this.cand.df <- data.frame("POS"=this.cand$POS,
"Range"=this.cand$RANGE,
"REF"=this.cand$REF,
"ALT"=this.cand$ALT,
"seq" = this.cand$seq,
"IUPAC" = this.cand$IUPAC)
consensus.seq <- paste(this.cand.df$IUPAC, collapse="")
consensus_seqlist[[i]] <- consensus.seq # add it to the main list
names(consensus_seqlist[[i]]) <- top.candidates[i]
}
folder <- "~/Desktop/Research/Glaziovii_introgression/chromosome_4/candidate_consensus_seqs_chr4/"
all.cand.seq.df <- data.frame(matrix(ncol = 2, nrow = length(consensus_seqlist)))
names(all.cand.seq.df) <- c("candidate","consensus")
for (i in 1:length(consensus_seqlist)) {
filepath <- paste(folder, names(consensus_seqlist[[i]]), '.txt', sep="")
write.table(consensus_seqlist[[i]], filepath, sep="\n")
all.cand.seq.df[i,2] <- consensus_seqlist[[i]]
all.cand.seq.df[i,1] <- names(consensus_seqlist[[i]])
}
write.csv(all.cand.seq.df, paste0(folder,"chr4.topcandidate.consensus.csv"))
names(consensus_seqlist)
all.cand.seq.df
all.cand.seq.df$candidate
class(all.cand.seq.df$candidate)
head(all.cand.seq.alleles)
all.cand.seq.alleles$v7_position
colnames(all.cand.seq.alleles)
all.cand.seq.alleles = all.cand.seq.alleles[order(as.numeric(all.cand.seq.alleles$v7_position)),]
all.cand.seq.alleles
all.cand.seq.alleles = all.cand.seq.alleles[order(as.numeric(all.cand.seq.alleles$v7_position)),]
rownames(all.cand.seq.alleles) = 1:nrow(all.cand.seq.alleles)
all.cand.seq.alleles[,1]
head(all.cand.seq.alleles)
write.csv(all.cand.seq.alleles, paste0(folder,"chr4.topcandidate.consensus.csv"))
write.csv(all.cand.seq.alleles, paste0(folder,"chr4.topcandidate.consensus.csv"))
library(stringr)
library(tidyr)
library(dplyr)
library(ggplot2)
setwd("/Users/serenwork/Desktop/Research/Glaziovii_introgression/KASP_design")
snp.stats <- read.csv("candidateregion.stats.csv")
snp.stats.overlap <- snp.stats[!is.na(snp.stats$Range.overlap),] #select positions where there is a secondary range.overlap candidate
rownames(snp.stats.overlap) <- 1:nrow(snp.stats.overlap)
snp.stats.overlap.sep <- separate(data=snp.stats.overlap, col=Candidate, into=c("cand2", "cand1"), sep=",")
#cand2 is the overlap candidate (associated with Range.overlap) #cand1 is associated with Range
#Prepare cand2 to merge
snp.stats.overlap.cand2 <- snp.stats.overlap.sep
snp.stats.overlap.cand2 <- subset(snp.stats.overlap.cand2, select = -c(cand1,Range) )
snp.stats.overlap.cand2$true.cand <- snp.stats.overlap.cand2$cand2 #here true.cand is the overlap candidate
snp.stats.overlap.cand2$Range <- snp.stats.overlap.cand2$Range.overlap #now Range is referring to the overlap candidate
#Prepare original dataframe to merge
candidates.split <- separate(data=snp.stats, col=Candidate, into=c("cand2", "cand1"), sep=",")
candidates.split$true.cand <- NA
candidates.split$true.cand <- ifelse(is.na(candidates.split$Range.overlap), candidates.split$cand2, candidates.split$cand1)
#candidates.split is only keeping data for cand1
#Merge rows associated with the first and second candidates
snp.stats.reslv <- bind_rows(candidates.split, snp.stats.overlap.cand2)
snp.stats.reslv <- snp.stats.reslv %>% select(4:ncol(snp.stats.reslv))
snp.stats.reslv <- snp.stats.reslv[,c(ncol(snp.stats.reslv),1:(ncol(snp.stats.reslv)-1))]
snp.stats <- snp.stats.reslv
# Calculate DP for glaz & hets (all samples)
colnums <- seq(from=10, to=99, by=3)
snp.stats$DP_SUM <- rowSums(snp.stats[,colnums])
# Calculate DP just for glaz samples
glazcolnums <- seq(from=10, to=22, by=3)
snp.stats$DP_SUM_glaz <- rowSums(snp.stats[,glazcolnums])
snp.stats.150 <- snp.stats
snp.stats <- snp.stats[which(snp.stats$Range <= 50 & snp.stats$Range >= -50),]
candidates <- read.table("~/Desktop/Research/Glaziovii_introgression/KASP_design/candidates0128.txt")
candidates <- candidates$V1
candidate.summary <- data.frame()
for (i in 1:length(candidates))
{
DP_SUMs_i <- snp.stats$DP_SUM[grepl(candidates[i], snp.stats$true.cand)]
mean_i <- mean(DP_SUMs_i)
min_i <- min(DP_SUMs_i)
max_i <- max(DP_SUMs_i)
DP_SUMs_g <- snp.stats$DP_SUM_glaz[grepl(candidates[i], snp.stats$true.cand)]
mean_g <- mean(DP_SUMs_g)
min_g <- min(DP_SUMs_g)
max_g <- max(DP_SUMs_g)
candidate.summary <- rbind(candidate.summary, c(candidates[i], mean_i, min_i, max_i, mean_g, min_g, max_g))
}
names(candidate.summary) <- c("candidate", "meanDP", "minDP", "maxDP", "meanglazDP", "minglazDP", "maxglazDP")
# Mean DP
hist(candidate.summary$meanDP, main = "mean DP in 100bp region around candidate SNP")
abline(v=400,col="red") #draw line for cutoff
# Minimum DP
hist(candidate.summary$minDP, main = "minimum DP in 100bp region around candidate SNP")
abline(v=100,col="red") #draw line for cutoff
# Maximum DP - could be artificially high depth in repeat regions which we want to avoid
hist(candidate.summary$maxDP, main = "maximum DP in 100bp region around candidate SNP")
abline(v=400,col="red") #draw line for cutoff
# Mean glaz DP
hist(candidate.summary$meanglazDP, main = "mean DP of glaziovii samples in 100bp region around candidate SNP", xlim = range(c(0,25,50,75,100,125,150, 175, 190)))
abline(v=100,col="red") #draw line for cutoff
# Min glaz DP
hist(candidate.summary$minglazDP, main = "min DP of glaziovii samples in 100bp region around candidate SNP")
abline(v=10,col="red") #draw line for cutoff
# Max glaz DP
hist(candidate.summary$maxglazDP, main = "max DP of glaziovii samples in 100bp region around candidate SNP")
abline(v=80,col="red") #draw line for cutoff
minDPcut <- 100
maxDPcut <- 400
meanDPlowcut <- 250
meanDPupcut <- 400
meanglazDPcut <- 70
minglazDPcut <- 10
maxglazDPcut <- 80
top.DP.candidates <- candidate.summary[which(
candidate.summary$minDP > minDPcut &
candidate.summary$maxDP < maxDPcut &
candidate.summary$meanDP > meanDPlowcut &
candidate.summary$meanDP < meanDPupcut &
candidate.summary$meanglazDP < meanglazDPcut &
candidate.summary$minglazDP > minglazDPcut &
candidate.summary$maxglazDP < maxglazDPcut
),]
# Visualize top DP candidates
hist(top.DP.candidates$meanDP, main = "mean DP across all samples\nat sites in 100bp region around candidate SNP")
hist(top.DP.candidates$meanglazDP, main= "mean DP across glaz samples\nat sites in 100bp region around candidate SNP")
conserved <- read.table("~/Desktop/Research/Glaziovii_introgression/KASP_design/conservedsites0128.txt")
conserved <- conserved$V1
conserved.summary <- data.frame()
for (i in 1:length(candidates))
{
pos_range_i <- snp.stats$POS[grepl(candidates[i], snp.stats$true.cand)]
cons_count_i <- length(intersect(pos_range_i, conserved))
conserved.summary <- rbind(conserved.summary, c(candidates[i], cons_count_i))
}
names(conserved.summary) <- c("candidate", "conserved.count")
hist(conserved.summary$conserved.count, main = "number of nonvariant sites\nin 100bp region around candidate SNP")
top.conserved <- slice_max(conserved.summary, order_by=conserved.count, n=40)
top.candidates <- intersect(top.conserved$candidate, top.DP.candidates$candidate)
#write.table(top.candidates, "top38candidateslist.txt", sep = "\n", col.names = FALSE, row.names = FALSE)
#write.table(top.conserved, "top38candidates_conservedsummary.csv", sep=",",col.names=TRUE, row.names= FALSE)
#top.conserved = read.csv("top38candidates_conservedsummary.csv")
top.candidates.graph <- data.frame(x=top.candidates, y=top.candidates+1)
ggplot(data=top.candidates.graph) +
geom_segment(aes(x=x, xend=(x+1), y=0, yend=1), color="steelblue", size=0.75) +
scale_y_continuous(labels=NULL) +
ggtitle("Distribution of top 38 KASP candidates")
ggsave("top.candidates.distribtion.graph.jpg",
plot = last_plot(),
width = 7,
height = 2,
units = "in")
#KASP primer ranges
ggplot(data=top.candidates.graph) +
geom_segment(aes(x=(x-50), xend=(x+50), y=0, yend=1), color="steelblue", size=0.5) +
scale_y_continuous(labels=NULL) +
ggtitle("Distribution of top 38 KASP candidates")
library(seqinr)
snp.stats.150$true.cand <- as.character(snp.stats.150$true.cand)
top.candidates <- as.character(top.candidates)
top.snp.stats <- snp.stats.150[which(grepl(paste(top.candidates, collapse="|"), snp.stats.150$true.cand)),]
#Initiate columns for IUPAC consensus sequences
top.snp.stats$seq <- NA
top.snp.stats$IUPAC <- NA
top.snp.stats$problem <- NA
#Flag indels - will fix these manually
top.snp.stats$problem[which(nchar(top.snp.stats$REF) != 1)] <- "y"
#remove commas from ALT string so multiple alt alleles get included in IUPAC
top.snp.stats$ALT_collapse <- sub(pattern=",", replacement="", x=top.snp.stats$ALT)
for (i in 1:nrow(top.snp.stats)) {
if (top.snp.stats[i, "ALT"] != '.') {
#wherever there is an alt allele, paste the ref & alt alleles together in the seq column
top.snp.stats[i, "seq"] <- paste(c(top.snp.stats[i, "REF"], top.snp.stats[i, "ALT_collapse"]), collapse="")
#if there is no alt allele, just put the ref allele in the seq column
} else {
top.snp.stats[i, "seq"] <- top.snp.stats[i, "REF"]
}
# make a consensus sequence with bma()
top.snp.stats$IUPAC[i] <- bma(unlist(strsplit(top.snp.stats$seq[i], split="")))
}
#capitalize the consensus
top.snp.stats$IUPAC <- toupper(top.snp.stats$IUPAC)
#add a bracket around the candidate SNP
top.snp.stats$IUPAC <- with(top.snp.stats, ifelse(!is.na(top.snp.stats$SNP_POS), paste0("[", REF, "/", ALT_collapse, "]"), IUPAC))
#fix and flag the indel sites
top.snp.stats$IUPAC <- with(top.snp.stats, ifelse(nchar(top.snp.stats$REF) != 1 , paste0("*(", REF, ")"), IUPAC))
#lowercase for low quality sites
top.snp.stats$IUPAC <- with(top.snp.stats, ifelse(top.snp.stats$DP_SUM_glaz < 30 | top.snp.stats$DP_SUM < 225, tolower(IUPAC), IUPAC))
#write.csv(top.snp.stats, "top.snp.stats.IUPAC.csv")
consensus_seqlist = list() # initiate list
for (i in 1:length(top.candidates)) {
this.cand.name <- top.candidates[i]
this.cand  <- top.snp.stats[which(grepl(top.candidates[i],
top.snp.stats$true.cand)),]
this.cand <- this.cand[,c(1:6,101:102)]
this.cand.df <- data.frame("POS"=this.cand$POS,
"Range"=this.cand$Range,
"REF"=this.cand$REF,
"ALT"=this.cand$ALT,
"seq" = this.cand$seq,
"IUPAC" = this.cand$IUPAC)
consensus.seq <- paste(this.cand.df$IUPAC, collapse="")
consensus_seqlist[[i]] <- consensus.seq # add it to the main list
names(consensus_seqlist[[i]]) <- top.candidates[i]
}
folder <- "candidate_consensus_seqs/"
all.cand.seq.df <- data.frame(matrix(ncol = 2, nrow = 38))
names(all.cand.seq.df) <- c("candidate","consensus")
for (i in 1:length(consensus_seqlist)) {
#filepath <- paste(folder, names(consensus_seqlist[[i]]), '.txt', sep="")
#write.table(consensus_seqlist[[i]], filepath, sep="\n")
all.cand.seq.df[i,2] <- consensus_seqlist[[i]]
all.cand.seq.df[i,1] <- names(consensus_seqlist[[i]])
}
#write.csv(all.cand.seq.df, "topcandidate.consensus.csv")
REF.ALT.list <- top.snp.stats[top.snp.stats$Range== 0, c(1,5,6)]
#write.csv(REF.ALT.list, "ref.alt.list.csv")
all.cand.seq.alleles = merge(all.cand.seq.df, REF.ALT.list, by.x="candidate", by.y="true.cand")
colnames(all.cand.seq.alleles)[1] <- "v7_position"
write.csv(all.cand.seq.alleles, "~/Desktop/Research/Glaziovii_introgression/KASP_design/candidate_consensus_seqs/chr1.topcandidate.consensus.csv")
head(all.cand.seq.alleles)
for(i in 1:nrow(all.cand.seq.alleles)){
diff = all.cand.seq.alleles$v7_position[i+1] - all.cand.seq.alleles$v7_position[i]
if(diff < 200000){
print(paste0(i, diff))
}
}
for(i in 1:nrow(all.cand.seq.alleles)){
diff = as.numeric(all.cand.seq.alleles$v7_position[i+1]) -
as.numeric(all.cand.seq.alleles$v7_position[i])
if(diff < 200000){
print(paste0(i, diff))
}
}
top.conserved$candidate
top.conserved$candidate[order(top.conserved$candidate),]
top.conserved$candidate[order(top.conserved$candidate)]
top.conserved
top.65.candidates
top.conserved
top.65.candidates$candidate
top.conserved <- slice_max(top.65.candidates, order_by=-other.snps, n=50)
top.conserved$candidate
ggplot(data=top.conserved) +
geom_segment(aes(x=candidate, xend=candidate+10, y=0, yend=1), color="steelblue", size=0.1) +
#geom_segment(aes(x=conserved.start, xend=conserved.stop, y=0, yend=1), color="red", size=0.001, alpha=0.05) +
scale_y_continuous(labels=NULL)
top.65.candidates$candidate
top.conserved
head(parent.clusters)
View(parent.clusters)
parent.clusters[parent.clusters$parent== "IBA000070",]
parent.clusters[parent.clusters$parent== "TMS14F1306P0015",]
parent.clusters[parent.clusters$kasp== "27643909",]
parent.clusters[parent.clusters$kasp== "27918064",]
parent.clusters.10kasp.sorted
kasp.list = read.csv("~/Desktop/Research/Glaziovii_introgression/KASP_design/Verification_05-2021/Intertek_verification_report.csv")[,2]
kasp.selection = kasp.list[c(1,3,6,12,16,20,30,32,36,38)]
intk.report.selected = subset(intk.report, intk.report$Customer.SNP.ID %in% kasp.selection)
write.csv(intk.report.selected, file="~/Desktop/Research/Glaziovii_introgression/KASP_design/selected.10.KASPs.csv")
parent.clusters = readRDS("~/Desktop/Research/Glaziovii_introgression/KASP_design/Verification_05-2021/parent.clusters.rds")
parent.clusters.10kasp = subset(parent.clusters, kasp %in% kasp.selection)
totalglaz = aggregate(as.numeric(mean.glazdose) ~ parent, FUN=mean, data=parent.clusters.10kasp)
colnames(totalglaz) = c("parent","totalglz")
parent.clusters.10kasp.tosort = join(parent.clusters.10kasp, totalglaz, by="parent", type="left")
parent.clusters.10kasp.sorted = parent.clusters.10kasp.tosort[order(parent.clusters.10kasp.tosort$totalglz),]
tiff("~/Desktop/Research/Glaziovii_introgression/KASP_design/Verification_05-2021/UBparents_intro_status_by_KASP_selected10", units="px", width=2500, height=1600, res=300)
ggplot(data = parent.clusters.10kasp.sorted) +
geom_point(aes(x=as.numeric(kasp), y=parent, color=cluster)) +
scale_color_manual(values=c("#FFFFFF", "#FF9900", "#0066FF", "gray95", "#FFCC66")) +
scale_x_continuous(name="Chromosome 1 Mbp")
dev.off()
parent.clusters.10kasp.sorted
setwd("~/Desktop/Research/Glaziovii_introgression/IITA_data_collection_seedling_nursery_2021/Tissue_sampling/")
missing.key = read.csv("~/Desktop/Research/Glaziovii_introgression/IITA_data_collection_seedling_nursery_2021/Nursery_layouts_barcodes/Seren_SN/Layouts/missing_21.GS.C6.SN.Student2.IB_table_updated-names.csv")
missing.key
require("readxl")
require("tidyverse")
setwd("~/Desktop/Research/Glaziovii_introgression/IITA_data_collection_seedling_nursery_2021/Tissue_sampling/")
file_list <- list.files(path="~/Desktop/Research/Glaziovii_introgression/IITA_data_collection_seedling_nursery_2021/Tissue_sampling/", full.names=FALSE)
all_plates <- data.frame()
for (i in 1:length(file_list)){
temp_data <- read.csv(file_list[i])
all_plates <- rbind(all_plates, temp_data)
}
all_plates$plate_id = sub("(?i)plate ", "plate_", all_plates$plate_id) #fix spaces and case
all_plates$plate_name = gsub(" ", "_", all_plates$plate_name)
layout = read.csv("~/Desktop/Research/Glaziovii_introgression/IITA_data_collection_seedling_nursery_2021/Nursery_layouts_barcodes/Seren_SN/Layouts/21.GS.C6.SN.Student2.IB_layout_old.csv")[,1:3]
layout$plot_number = as.character(layout$plot_number)
missing.key = read.csv("~/Desktop/Research/Glaziovii_introgression/IITA_data_collection_seedling_nursery_2021/Nursery_layouts_barcodes/Seren_SN/Layouts/missing_21.GS.C6.SN.Student2.IB_table_updated-names.csv")
#make a column for the type of name listed as the tissue ID
all_plates$name_type[grepl("^TMS", all_plates$tissue_id)] = "acc.name"
all_plates$name_type[grepl("^21.GS.C6", all_plates$tissue_id)] = "full.name"
all_plates$name_type[grepl("^([0-9])+$", all_plates$tissue_id)] = "plot.num"
all_plates$name_type[grepl("BLANK", all_plates$tissue_id)] = "blank"
all_plates$name_type[c(2975,3065:3069)] = "full.name" #manually set wilds
#for each name type, find the association full name and put it in a new column
for(i in 1:nrow(all_plates)){
if(all_plates$name_type[i] == "plot.num"){
lookup = layout$plot_name[grep(paste0("^",all_plates$tissue_id[i],"$"), layout$plot_number)]
if(length(lookup)!=0){
all_plates$full_name[i] <- lookup
} else{
all_plates$full_name[i] <- all_plates$tissue_id[i]
#print(paste0("error at ",i))
}
}
)
lookup = grep(all_plates$tissue_id[1], layout$plot_name, value=TRUE)
lookup
length(lookup)
missing.key$accession_name_old
grep(all_plates$tissue_id[i], missing.key$accession_name_old, value=TRUE)
grep(all_plates$tissue_id[1], missing.key$accession_name_old, value=TRUE)
grep(all_plates$tissue_id[16], missing.key$accession_name_old, value=TRUE)
grep(all_plates$tissue_id[16], missing.key$accession_name_old, value=FALSE)
length(grep(all_plates$tissue_id[16], missing.key$accession_name_old, value=FALSE))
#make a column for the type of name listed as the tissue ID
all_plates$name_type[grepl("^TMS", all_plates$tissue_id)] = "acc.name"
all_plates$name_type[grepl("^21.GS.C6", all_plates$tissue_id)] = "full.name"
all_plates$name_type[grepl("^([0-9])+$", all_plates$tissue_id)] = "plot.num"
all_plates$name_type[grepl("BLANK", all_plates$tissue_id)] = "blank"
all_plates$name_type[c(2975,3065:3069)] = "full.name" #manually set wilds
#for each name type, find the associated full name and put it in a new column
for(i in 1:nrow(all_plates)){
#look up by plot number; find associated full accession name
if(all_plates$name_type[i] == "plot.num"){
lookup = layout$plot_name[grep(paste0("^",all_plates$tissue_id[i],"$"), layout$plot_number)]
if(length(lookup)!=0){
all_plates$full_name[i] <- lookup
} else{
all_plates$full_name[i] <- all_plates$tissue_id[i]
#print(paste0("error at ",i))
}
}
#look up by accession name; fix the name if it's from the missing plants layout
if(all_plates$name_type[i] == "acc.name"){
lookup = grep(all_plates$tissue_id[i], layout$plot_name, value=TRUE)
if(length(lookup)!=0){
all_plates$full_name[i] <- lookup
} else{
#check if it's in the missing names key
lookup2 = grep(all_plates$tissue_id[i], missing.key$accession_name_old, value=F)
if(length(lookup2)!=0){
all_plates$full_name[i] <-
paste0("21.GS.C6.SN.Student2.IB.missing-", missing.key$accession_name_new[lookup2]) }
else{
all_plates$full_name[i] <- paste0("21.GS.C6.SN.Student2.IB.missing-",
all_plates$tissue_id[i])}
}
}
#leave it if it's already the full name
if(all_plates$name_type[i] == "full.name" | all_plates$name_type[i] == "blank"){
all_plates$full_name[i] <- all_plates$tissue_id[i]
}
}
all_plates_export = all_plates
all_plates_export$tissue_id <- all_plates_export$full_name
head(all_plates_export)
head(all_plates_export$tissue_id, n=100)
setwd("~/Desktop/Research/Glaziovii_introgression/IITA_data_collection_seedling_nursery_2021/")
write.csv(all_plates_export[,1:11], "21.GS.C6.SN.Student2_plate_coordinates.csv")
?duplicated()
duplicated(all_plates_export$tissue_id)
anyDuplicated(all_plates_export$tissue_id)
all_plates_export[duplicated(all_plates_export$tissue_id),]
all_plates_export[all_plates_export$full_name == "21.GS.C6.SN.Student2.IB-plant280-TMS21F1987P0009",]
all_plates_export[all_plates_export$full_name == "21.GS.C6.SN.Student2.IB-plant787-TMS21F2040P0003",]
all_plates_export[all_plates_export$full_name == "21.GS.C6.SN.Student2.IB-plant3433-TMS21F2238P0061",]
all_plates_export[duplicated(all_plates_export$tissue_id),]
all_plates_export[all_plates_export$full_name == "21.GS.C6.SN.Student2.IB-plant3574-TMS21F2240P0008",]
all_plates_export[all_plates_export$full_name == "21.GS.C6.SN.Student2.IB-plant4897-TMS21F2251P0055",]
all_plates_export[all_plates_export$full_name == "21.GS.C6.SN.Student2.IB-plant4899-TMS21F2251P0057",]
all_plates_export[all_plates_export$full_name == "21.GS.C6.SN.Student2.IB.missing-TMS14F1035P0004",]
layout = read.csv("~/Desktop/Research/Glaziovii_introgression/IITA_data_collection_seedling_nursery_2021/Nursery_layouts_barcodes/Seren_SN/Layouts/21.GS.C6.SN.Student2.IB_layout_old.csv")
head(layout)
parents = read.csv("~/Desktop/Research/Glaziovii_introgression/parent_list_grp.csv")
head(parents)
parents = read.csv("~/Desktop/Research/Glaziovii_introgression/parent_list_grp.csv")[,1]
parents
intk.report = read.csv("~/Desktop/Research/Glaziovii_introgression/KASP_design/Verification_05-2021/Intertek_verification_report.csv")
kasp.snps = intk.report[,2]
head(intk.report)
setwd("/Users/serenwork/Desktop/Research/Glaziovii_introgression/KASP_design/Verification_05-2021/")
rawdat = read.csv("Genotyping-014.038-01_reclustering.csv")
snps = unique(rawdat$SNPID)
rawdat$parent = str_replace(rawdat$SubjectID, pattern="_A.*", "")
head(rawdat)
parents = unique(rawdat$parent)
cross.parents = read.csv("~/Desktop/Research/Glaziovii_introgression/parent_list_grp.csv")[,1]
parents
cross.parents = read.csv("~/Desktop/Research/Glaziovii_introgression/parent_list_grp.csv")[,1]
cross.parents %in% parents
length(cross.parents %in% parents)
sum(cross.parents %in% parents)
length(cross.parents)
head(cross.parents)
nrow(cross.parents)
cross.parents
cross.parents = read.table("~/Desktop/Research/Glaziovii_introgression/unique_parents_list.txt")
head(cross.parents)
cross.parents = read.table("~/Desktop/Research/Glaziovii_introgression/unique_parents_list.txt")[,1]
length(cross.parents)
cross.parents %in% parents
sum(cross.parents %in% parents)
head(all_plates_export)
head(layout)
?str_extract()
head(str_extract(layout$accession_name, "F*P")
)
str_extract(layout$accession_name, "F*P$")
head(str_extract(layout$accession_name, "^F*P$"))
head(str_extract(layout$accession_name, "F*"))
head(str_extract(layout$accession_name, "F*P"))
head(str_extract(layout$accession_name, "F*P*"))
head(str_extract(layout$accession_name, "F[1-9]+P*"))
head(str_extract(layout$accession_name, "F[1-9]+P"))
head(str_extract(layout$accession_name, "F[1-9]+"))
families = str_extract(layout$accession_name, "F[1-9]+")
head(families)
families = unique(str_extract(layout$accession_name, "F[1-9]+"))
head(families)
head(families,n=100)
families = unique(str_extract(layout$accession_name, "F[0-9]+"))
head(families,n=100)
length(families)
