nchar(top.snp.stats$REF[2])
nchar(top.snp.stats$ALT[1])
top.snp.stats[which(nchar(top.snp.stats$REF) != 1),]
top.snp.stats$problem[which(nchar(top.snp.stats$REF) != 1)] <- y
top.snp.stats$problem[which(nchar(top.snp.stats$REF) != 1)] <- "y"
top.snp.stats[which(nchar(top.snp.stats$ALT) != 1),]
top.snp.stats$problem[which(nchar(top.snp.stats$REF) != 1 | nchar(top.snp.stats$ALT) != 1] <- "y"
top.snp.stats$problem[which(nchar(top.snp.stats$REF) != 1 | nchar(top.snp.stats$ALT) != 1)] <- "y"
head(top.snp.stats$problem)
tail(top.snp.stats$problem)
?str_sub()
?sub()
top.snp.stats$ALT_collapse <- sub(pattern=",", replacement="", x=top.snp.stats$ALT)
head(top.snp.stats$ALT_collapse)
tail(top.snp.stats$ALT_collapse)
head(top.snp.stats$ALT_collapse, n=100)
head(top.snp.stats$ALT_collapse, n=200)
head(top.snp.stats$ALT_collapse, n=300)
head(top.snp.stats$ALT, n=300)
head(top.snp.stats$IUPAC[which(top.snp.stats$problem == 'y')])
snp.stats.150$true.cand <- as.character(snp.stats.150$true.cand)
top.candidates <- as.character(top.candidates)
top.snp.stats <- snp.stats.150[which(grepl(paste(top.candidates, collapse="|"), snp.stats.150$true.cand)),]
#Initiate columns for IUPAC consensus sequences
top.snp.stats$seq <- NA
top.snp.stats$IUPAC <- NA
#Flag indels - will fix these manually
top.snp.stats$problem[which(nchar(top.snp.stats$REF) != 1 | nchar(top.snp.stats$ALT) != 1)] <- "y"
top.snp.stats[which(nchar(top.snp.stats$REF) != 1 | nchar(top.snp.stats$ALT) != 1),]
top.snp.stats <- snp.stats.150[which(grepl(paste(top.candidates, collapse="|"), snp.stats.150$true.cand)),]
#Initiate columns for IUPAC consensus sequences
top.snp.stats$seq <- NA
top.snp.stats$IUPAC <- NA
top.snp.stats$problem <- NA
#Flag indels - will fix these manually
top.snp.stats$problem[which(nchar(top.snp.stats$REF) != 1 | nchar(top.snp.stats$ALT) != 1)] <- "y"
top.snp.stats$ALT_collapse <- sub(pattern=",", replacement="", x=top.snp.stats$ALT)
for (i in 1:nrow(top.snp.stats)) {
if (top.snp.stats[i, "ALT"] != '.') {
#wherever there is an alt allele, paste the ref & alt alleles together in the seq column
top.snp.stats[i, "seq"] <- paste(c(top.snp.stats[i, "REF"], top.snp.stats[i, "ALT_collapse"]), collapse="")
#if there is no alt allele, just put the ref allele in the seq column
} else {
top.snp.stats[i, "seq"] <- top.snp.stats[i, "REF"]
}
# make a consensus sequence with bma()
top.snp.stats$IUPAC[i] <- bma(unlist(strsplit(top.snp.stats$seq[i], split="")))
}
head(top.snp.stats)
top.snp.stats <- snp.stats.150[which(grepl(paste(top.candidates, collapse="|"), snp.stats.150$true.cand)),]
#Initiate columns for IUPAC consensus sequences
top.snp.stats$seq <- NA
top.snp.stats$IUPAC <- NA
top.snp.stats$problem <- NA
#Flag indels - will fix these manually
top.snp.stats$problem[which(nchar(top.snp.stats$REF) != 1 | nchar(top.snp.stats$ALT) != 1)] <- "y"
#remove commas from ALT string so multiple alt alleles get included in IUPAC
top.snp.stats$ALT_collapse <- sub(pattern=",", replacement="", x=top.snp.stats$ALT)
colnames(top.snp.stats)
head(top.snp.stats)
bma(unlist(strsplit(top.snp.stats$seq[1], split="")))
top.snp.stats$seq[1]
top.snp.stats[3, "seq"] <- paste(c(top.snp.stats[3, "REF"], top.snp.stats[3, "ALT_collapse"]), collapse="")
#if there is no alt allele, just put the ref allele in the seq column
} else {
top.snp.stats[3, "seq"] <- paste(c(top.snp.stats[3, "REF"], top.snp.stats[3, "ALT_collapse"]), collapse="")
top.snp.stats$IUPAC[3] <- bma(unlist(strsplit(top.snp.stats$seq[i], split="")))
top.snp.stats[3,]
bma(unlist(strsplit(top.snp.stats$seq[3], split="")))
top.snp.stats <- snp.stats.150[which(grepl(paste(top.candidates, collapse="|"), snp.stats.150$true.cand)),]
#Initiate columns for IUPAC consensus sequences
top.snp.stats$seq <- NA
top.snp.stats$IUPAC <- NA
top.snp.stats$problem <- NA
#Flag indels - will fix these manually
top.snp.stats$problem[which(nchar(top.snp.stats$REF) != 1 | nchar(top.snp.stats$ALT) != 1)] <- "y"
#remove commas from ALT string so multiple alt alleles get included in IUPAC
top.snp.stats$ALT_collapse <- sub(pattern=",", replacement="", x=top.snp.stats$ALT)
for (i in 1:nrow(top.snp.stats)) {
if (top.snp.stats[i, "ALT"] != '.') {
#wherever there is an alt allele, paste the ref & alt alleles together in the seq column
top.snp.stats[i, "seq"] <- paste(c(top.snp.stats[i, "REF"], top.snp.stats[i, "ALT_collapse"]), collapse="")
#if there is no alt allele, just put the ref allele in the seq column
} else {
top.snp.stats[i, "seq"] <- top.snp.stats[i, "REF"]
}
# make a consensus sequence with bma()
top.snp.stats$IUPAC[i] <- bma(unlist(strsplit(top.snp.stats$seq[i], split="")))
}
head(top.snp.stats)
top.snp.stats$IUPAC <- toupper(top.snp.stats$IUPAC)
#add a bracket around the candidate SNP
top.snp.stats$IUPAC[which(!is.na(top.snp.stats$SNP_POS))] <- paste0("[", IUPAC, "]")
top.snp.stats$IUPAC <- with(top.snp.stats, ifelse(!is.na(top.snp.stats$SNP_POS), paste0("[", IUPAC, "]"), IUPAC))
head(top.snp.stats$IUPAC)
head(top.snp.stats$IUPAC, n=200)
top.snp.stats$IUPAC <- toupper(top.snp.stats$IUPAC)
#add a bracket around the candidate SNP
top.snp.stats$IUPAC <- with(top.snp.stats, ifelse(!is.na(top.snp.stats$SNP_POS), paste0("[", IUPAC, "]"), IUPAC))
#flag the problem sites
top.snp.stats$IUPAC[which(top.snp.stats$problem == 'y')] <- "*"
write.csv(top.snp.stats, "top.snp.stats.IUPAC.csv")
consensus_seqlist = list() # initiate list
for (i in 1:length(top.candidates)) {
this.cand.name <- top.candidates[i]
this.cand  <- top.snp.stats[which(grepl(top.candidates[i],
top.snp.stats$true.cand)),]
this.cand <- this.cand[,c(1:6,101:102)]
this.cand.df <- data.frame("POS"=this.cand$POS,
"Range"=this.cand$Range,
"REF"=this.cand$REF,
"ALT"=this.cand$ALT,
"seq" = this.cand$seq,
"IUPAC" = this.cand$IUPAC)
consensus.seq <- paste(this.cand.df$IUPAC, collapse="")
consensus_seqlist[[i]] <- consensus.seq # add it to the main list
names(consensus_seqlist[[i]]) <- top.candidates[i]
}
folder <- "candidate_consensus_seqs/"
all.cand.seq.df <- data.frame(matrix(ncol = 2, nrow = 38))
names(all.cand.seq.df) <- c("candidate","consensus")
for (i in 1:length(consensus_seqlist)) {
#filepath <- paste(folder, names(consensus_seqlist[[i]]), '.txt', sep="")
#write.table(consensus_seqlist[[i]], filepath, sep="\n")
all.cand.seq.df[i,2] <- consensus_seqlist[[i]]
all.cand.seq.df[i,1] <- names(consensus_seqlist[[i]])
}
write.csv(all.cand.seq.df, "topcandidate.consensus.csv", col.names=TRUE)
top.snp.stats <- snp.stats.150[which(grepl(paste(top.candidates, collapse="|"), snp.stats.150$true.cand)),]
#Initiate columns for IUPAC consensus sequences
top.snp.stats$seq <- NA
top.snp.stats$IUPAC <- NA
top.snp.stats$problem <- NA
#Flag indels - will fix these manually
top.snp.stats$problem[which(nchar(top.snp.stats$REF) != 1 | nchar(top.snp.stats$ALT) != 1)] <- "y"
#remove commas from ALT string so multiple alt alleles get included in IUPAC
top.snp.stats$ALT_collapse <- sub(pattern=",", replacement="", x=top.snp.stats$ALT)
for (i in 1:nrow(top.snp.stats)) {
if (top.snp.stats[i, "ALT"] != '.') {
#wherever there is an alt allele, paste the ref & alt alleles together in the seq column
top.snp.stats[i, "seq"] <- paste(c(top.snp.stats[i, "REF"], top.snp.stats[i, "ALT_collapse"]), collapse="")
#if there is no alt allele, just put the ref allele in the seq column
} else {
top.snp.stats[i, "seq"] <- top.snp.stats[i, "REF"]
}
# make a consensus sequence with bma()
top.snp.stats$IUPAC[i] <- bma(unlist(strsplit(top.snp.stats$seq[i], split="")))
}
#capitalize the consensus
top.snp.stats$IUPAC <- toupper(top.snp.stats$IUPAC)
#add a bracket around the candidate SNP
top.snp.stats$IUPAC <- with(top.snp.stats, ifelse(!is.na(top.snp.stats$SNP_POS), paste0("[", IUPAC, "]"), IUPAC))
#flag the problem sites
top.snp.stats$IUPAC[which(top.snp.stats$problem == 'y')] <- "*"
write.csv(top.snp.stats, "top.snp.stats.IUPAC.csv")
consensus_seqlist = list() # initiate list
for (i in 1:length(top.candidates)) {
this.cand.name <- top.candidates[i]
this.cand  <- top.snp.stats[which(grepl(top.candidates[i],
top.snp.stats$true.cand)),]
this.cand <- this.cand[,c(1:6,101:102)]
this.cand.df <- data.frame("POS"=this.cand$POS,
"Range"=this.cand$Range,
"REF"=this.cand$REF,
"ALT"=this.cand$ALT,
"seq" = this.cand$seq,
"IUPAC" = this.cand$IUPAC)
consensus.seq <- paste(this.cand.df$IUPAC, collapse="")
consensus_seqlist[[i]] <- consensus.seq # add it to the main list
names(consensus_seqlist[[i]]) <- top.candidates[i]
}
folder <- "candidate_consensus_seqs/"
all.cand.seq.df <- data.frame(matrix(ncol = 2, nrow = 38))
names(all.cand.seq.df) <- c("candidate","consensus")
for (i in 1:length(consensus_seqlist)) {
#filepath <- paste(folder, names(consensus_seqlist[[i]]), '.txt', sep="")
#write.table(consensus_seqlist[[i]], filepath, sep="\n")
all.cand.seq.df[i,2] <- consensus_seqlist[[i]]
all.cand.seq.df[i,1] <- names(consensus_seqlist[[i]])
}
write.csv(all.cand.seq.df, "topcandidate.consensus.csv", col.names=TRUE)
write.csv(top.snp.stats, "top.snp.stats.IUPAC.csv")
consensus.seq
head(all.cand.seq.df)
write.csv(all.cand.seq.df, "topcandidate.consensus.csv")
top.snp.stats <- snp.stats.150[which(grepl(paste(top.candidates, collapse="|"), snp.stats.150$true.cand)),]
#Initiate columns for IUPAC consensus sequences
top.snp.stats$seq <- NA
top.snp.stats$IUPAC <- NA
top.snp.stats$problem <- NA
#Flag indels - will fix these manually
top.snp.stats$problem[which(nchar(top.snp.stats$REF) != 1)] <- "y"
#remove commas from ALT string so multiple alt alleles get included in IUPAC
top.snp.stats$ALT_collapse <- sub(pattern=",", replacement="", x=top.snp.stats$ALT)
for (i in 1:nrow(top.snp.stats)) {
if (top.snp.stats[i, "ALT"] != '.') {
#wherever there is an alt allele, paste the ref & alt alleles together in the seq column
top.snp.stats[i, "seq"] <- paste(c(top.snp.stats[i, "REF"], top.snp.stats[i, "ALT_collapse"]), collapse="")
#if there is no alt allele, just put the ref allele in the seq column
} else {
top.snp.stats[i, "seq"] <- top.snp.stats[i, "REF"]
}
# make a consensus sequence with bma()
top.snp.stats$IUPAC[i] <- bma(unlist(strsplit(top.snp.stats$seq[i], split="")))
}
#capitalize the consensus
top.snp.stats$IUPAC <- toupper(top.snp.stats$IUPAC)
#add a bracket around the candidate SNP
top.snp.stats$IUPAC <- with(top.snp.stats, ifelse(!is.na(top.snp.stats$SNP_POS), paste0("[", IUPAC, "]"), IUPAC))
top.snp.stats$IUPAC <- with(top.snp.stats, ifelse(top.snp.stats$problem == 'y', paste0(IUPAC, "*"), IUPAC))
write.csv(top.snp.stats, "top.snp.stats.IUPAC.csv")
consensus_seqlist = list() # initiate list
for (i in 1:length(top.candidates)) {
this.cand.name <- top.candidates[i]
this.cand  <- top.snp.stats[which(grepl(top.candidates[i],
top.snp.stats$true.cand)),]
this.cand <- this.cand[,c(1:6,101:102)]
this.cand.df <- data.frame("POS"=this.cand$POS,
"Range"=this.cand$Range,
"REF"=this.cand$REF,
"ALT"=this.cand$ALT,
"seq" = this.cand$seq,
"IUPAC" = this.cand$IUPAC)
consensus.seq <- paste(this.cand.df$IUPAC, collapse="")
consensus_seqlist[[i]] <- consensus.seq # add it to the main list
names(consensus_seqlist[[i]]) <- top.candidates[i]
}
folder <- "candidate_consensus_seqs/"
all.cand.seq.df <- data.frame(matrix(ncol = 2, nrow = 38))
names(all.cand.seq.df) <- c("candidate","consensus")
for (i in 1:length(consensus_seqlist)) {
#filepath <- paste(folder, names(consensus_seqlist[[i]]), '.txt', sep="")
#write.table(consensus_seqlist[[i]], filepath, sep="\n")
all.cand.seq.df[i,2] <- consensus_seqlist[[i]]
all.cand.seq.df[i,1] <- names(consensus_seqlist[[i]])
}
write.csv(all.cand.seq.df, "topcandidate.consensus.csv")
write.csv(all.cand.seq.df, "topcandidate.consensus.csv")
write.csv(top.snp.stats, "top.snp.stats.IUPAC.csv")
top.snp.stats <- snp.stats.150[which(grepl(paste(top.candidates, collapse="|"), snp.stats.150$true.cand)),]
#Initiate columns for IUPAC consensus sequences
top.snp.stats$seq <- NA
top.snp.stats$IUPAC <- NA
top.snp.stats$problem <- NA
#Flag indels - will fix these manually
top.snp.stats$problem[which(nchar(top.snp.stats$REF) != 1)] <- "y"
head(top.snp.stats$problem, n=200)
head(top.snp.stats$problem, n=300)
head(top.snp.stats$problem, n=400)
tail(top.snp.stats$problem, n=400)
top.snp.stats$ALT_collapse <- sub(pattern=",", replacement="", x=top.snp.stats$ALT)
for (i in 1:nrow(top.snp.stats)) {
if (top.snp.stats[i, "ALT"] != '.') {
#wherever there is an alt allele, paste the ref & alt alleles together in the seq column
top.snp.stats[i, "seq"] <- paste(c(top.snp.stats[i, "REF"], top.snp.stats[i, "ALT_collapse"]), collapse="")
#if there is no alt allele, just put the ref allele in the seq column
} else {
top.snp.stats[i, "seq"] <- top.snp.stats[i, "REF"]
}
# make a consensus sequence with bma()
top.snp.stats$IUPAC[i] <- bma(unlist(strsplit(top.snp.stats$seq[i], split="")))
}
head(top.snp.stats$IUPAC)
head(top.snp.stats$REF)
head(top.snp.stats$ALT)
top.snp.stats$IUPAC <- toupper(top.snp.stats$IUPAC)
top.snp.stats$IUPAC <- with(top.snp.stats, ifelse(!is.na(top.snp.stats$SNP_POS), paste0("[", IUPAC, "]"), IUPAC))
head(top.snp.stats$IUPAC)
head(top.snp.stats$IUPAC, n=300)
tail(top.snp.stats$IUPAC, n=300)
is.na(top.snp.stats$IUPAC)
which(is.na(top.snp.stats$IUPAC))
top.snp.stats$IUPAC[which(nchar(top.snp.stats$REF) != 1)] <- paste0(top.snp.stats$REF, "*")
top.snp.stats$IUPAC[which(nchar(top.snp.stats$REF) != 1)]
op.snp.stats <- snp.stats.150[which(grepl(paste(top.candidates, collapse="|"), snp.stats.150$true.cand)),]
#Initiate columns for IUPAC consensus sequences
top.snp.stats$seq <- NA
top.snp.stats$IUPAC <- NA
top.snp.stats$problem <- NA
#Flag indels - will fix these manually
top.snp.stats$problem[which(nchar(top.snp.stats$REF) != 1)] <- "y"
#remove commas from ALT string so multiple alt alleles get included in IUPAC
top.snp.stats$ALT_collapse <- sub(pattern=",", replacement="", x=top.snp.stats$ALT)
for (i in 1:nrow(top.snp.stats)) {
if (top.snp.stats[i, "ALT"] != '.') {
#wherever there is an alt allele, paste the ref & alt alleles together in the seq column
top.snp.stats[i, "seq"] <- paste(c(top.snp.stats[i, "REF"], top.snp.stats[i, "ALT_collapse"]), collapse="")
#if there is no alt allele, just put the ref allele in the seq column
} else {
top.snp.stats[i, "seq"] <- top.snp.stats[i, "REF"]
}
# make a consensus sequence with bma()
top.snp.stats$IUPAC[i] <- bma(unlist(strsplit(top.snp.stats$seq[i], split="")))
}
#capitalize the consensus
top.snp.stats$IUPAC <- toupper(top.snp.stats$IUPAC)
#add a bracket around the candidate SNP
top.snp.stats$IUPAC <- with(top.snp.stats, ifelse(!is.na(top.snp.stats$SNP_POS), paste0("[", IUPAC, "]"), IUPAC))
top.snp.stats[which(nchar(top.snp.stats$REF) != 1),]
top.snp.stats$IUPAC[which(nchar(top.snp.stats$REF) != 1)]
top.snp.stats$IUPAC <-with(top.snp.stats, ifelse(nchar(top.snp.stats$REF) != 1 , paste0(REF, "*"), IUPAC))
head(top.snp.stats$IUPAC)
head(top.snp.stats$IUPAC, n=300)
tail(top.snp.stats$IUPAC, n=300)
write.csv(top.snp.stats, "top.snp.stats.IUPAC.csv")
consensus_seqlist = list() # initiate list
for (i in 1:length(top.candidates)) {
this.cand.name <- top.candidates[i]
this.cand  <- top.snp.stats[which(grepl(top.candidates[i],
top.snp.stats$true.cand)),]
this.cand <- this.cand[,c(1:6,101:102)]
this.cand.df <- data.frame("POS"=this.cand$POS,
"Range"=this.cand$Range,
"REF"=this.cand$REF,
"ALT"=this.cand$ALT,
"seq" = this.cand$seq,
"IUPAC" = this.cand$IUPAC)
consensus.seq <- paste(this.cand.df$IUPAC, collapse="")
consensus_seqlist[[i]] <- consensus.seq # add it to the main list
names(consensus_seqlist[[i]]) <- top.candidates[i]
}
folder <- "candidate_consensus_seqs/"
all.cand.seq.df <- data.frame(matrix(ncol = 2, nrow = 38))
names(all.cand.seq.df) <- c("candidate","consensus")
for (i in 1:length(consensus_seqlist)) {
#filepath <- paste(folder, names(consensus_seqlist[[i]]), '.txt', sep="")
#write.table(consensus_seqlist[[i]], filepath, sep="\n")
all.cand.seq.df[i,2] <- consensus_seqlist[[i]]
all.cand.seq.df[i,1] <- names(consensus_seqlist[[i]])
}
write.csv(all.cand.seq.df, "topcandidate.consensus.csv")
top.snp.stats <- snp.stats.150[which(grepl(paste(top.candidates, collapse="|"), snp.stats.150$true.cand)),]
#Initiate columns for IUPAC consensus sequences
top.snp.stats$seq <- NA
top.snp.stats$IUPAC <- NA
top.snp.stats$problem <- NA
#Flag indels - will fix these manually
top.snp.stats$problem[which(nchar(top.snp.stats$REF) != 1)] <- "y"
#remove commas from ALT string so multiple alt alleles get included in IUPAC
top.snp.stats$ALT_collapse <- sub(pattern=",", replacement="", x=top.snp.stats$ALT)
for (i in 1:nrow(top.snp.stats)) {
if (top.snp.stats[i, "ALT"] != '.') {
#wherever there is an alt allele, paste the ref & alt alleles together in the seq column
top.snp.stats[i, "seq"] <- paste(c(top.snp.stats[i, "REF"], top.snp.stats[i, "ALT_collapse"]), collapse="")
#if there is no alt allele, just put the ref allele in the seq column
} else {
top.snp.stats[i, "seq"] <- top.snp.stats[i, "REF"]
}
# make a consensus sequence with bma()
top.snp.stats$IUPAC[i] <- bma(unlist(strsplit(top.snp.stats$seq[i], split="")))
}
#capitalize the consensus
top.snp.stats$IUPAC <- toupper(top.snp.stats$IUPAC)
#add a bracket around the candidate SNP
top.snp.stats$IUPAC <- with(top.snp.stats, ifelse(!is.na(top.snp.stats$SNP_POS), paste0("[", IUPAC, "]"), IUPAC))
#fix and flag the indel sites
top.snp.stats$IUPAC <-with(top.snp.stats, ifelse(nchar(top.snp.stats$REF) != 1 , paste0("*(", REF, ")"), IUPAC))
write.csv(top.snp.stats, "top.snp.stats.IUPAC.csv")
consensus_seqlist = list() # initiate list
for (i in 1:length(top.candidates)) {
this.cand.name <- top.candidates[i]
this.cand  <- top.snp.stats[which(grepl(top.candidates[i],
top.snp.stats$true.cand)),]
this.cand <- this.cand[,c(1:6,101:102)]
this.cand.df <- data.frame("POS"=this.cand$POS,
"Range"=this.cand$Range,
"REF"=this.cand$REF,
"ALT"=this.cand$ALT,
"seq" = this.cand$seq,
"IUPAC" = this.cand$IUPAC)
consensus.seq <- paste(this.cand.df$IUPAC, collapse="")
consensus_seqlist[[i]] <- consensus.seq # add it to the main list
names(consensus_seqlist[[i]]) <- top.candidates[i]
}
folder <- "candidate_consensus_seqs/"
all.cand.seq.df <- data.frame(matrix(ncol = 2, nrow = 38))
names(all.cand.seq.df) <- c("candidate","consensus")
for (i in 1:length(consensus_seqlist)) {
#filepath <- paste(folder, names(consensus_seqlist[[i]]), '.txt', sep="")
#write.table(consensus_seqlist[[i]], filepath, sep="\n")
all.cand.seq.df[i,2] <- consensus_seqlist[[i]]
all.cand.seq.df[i,1] <- names(consensus_seqlist[[i]])
}
write.csv(all.cand.seq.df, "topcandidate.consensus.csv")
colnames(top.snp.stats)
head(top.snp.stats$DP_SUM)
hist(top.snp.stats$DP_SUM)
hist(top.snp.stats$DP_SUM)
hist(top.snp.stats$DP_SUM_glaz)
?tolower()
hist(top.snp.stats$DP_SUM)
top.snp.stats$IUPAC <- with(top.snp.stats, ifelse(top.snp.stats$DP_SUM_glaz < 35 | top.snp.stats$DP_SUM < 250, tolower(IUPAC), IUPAC))
head(top.snp.stats$IUPAC, n=400)
write.csv(top.snp.stats, "top.snp.stats.IUPAC.csv")
consensus_seqlist = list() # initiate list
for (i in 1:length(top.candidates)) {
this.cand.name <- top.candidates[i]
this.cand  <- top.snp.stats[which(grepl(top.candidates[i],
top.snp.stats$true.cand)),]
this.cand <- this.cand[,c(1:6,101:102)]
this.cand.df <- data.frame("POS"=this.cand$POS,
"Range"=this.cand$Range,
"REF"=this.cand$REF,
"ALT"=this.cand$ALT,
"seq" = this.cand$seq,
"IUPAC" = this.cand$IUPAC)
consensus.seq <- paste(this.cand.df$IUPAC, collapse="")
consensus_seqlist[[i]] <- consensus.seq # add it to the main list
names(consensus_seqlist[[i]]) <- top.candidates[i]
}
folder <- "candidate_consensus_seqs/"
all.cand.seq.df <- data.frame(matrix(ncol = 2, nrow = 38))
names(all.cand.seq.df) <- c("candidate","consensus")
for (i in 1:length(consensus_seqlist)) {
#filepath <- paste(folder, names(consensus_seqlist[[i]]), '.txt', sep="")
#write.table(consensus_seqlist[[i]], filepath, sep="\n")
all.cand.seq.df[i,2] <- consensus_seqlist[[i]]
all.cand.seq.df[i,1] <- names(consensus_seqlist[[i]])
}
write.csv(all.cand.seq.df, "topcandidate.consensus.csv")
hist(top.snp.stats$DP_SUM_glaz)
hist(top.snp.stats$DP_SUM)
top.snp.stats <- snp.stats.150[which(grepl(paste(top.candidates, collapse="|"), snp.stats.150$true.cand)),]
#Initiate columns for IUPAC consensus sequences
top.snp.stats$seq <- NA
top.snp.stats$IUPAC <- NA
top.snp.stats$problem <- NA
#Flag indels - will fix these manually
top.snp.stats$problem[which(nchar(top.snp.stats$REF) != 1)] <- "y"
#remove commas from ALT string so multiple alt alleles get included in IUPAC
top.snp.stats$ALT_collapse <- sub(pattern=",", replacement="", x=top.snp.stats$ALT)
for (i in 1:nrow(top.snp.stats)) {
if (top.snp.stats[i, "ALT"] != '.') {
#wherever there is an alt allele, paste the ref & alt alleles together in the seq column
top.snp.stats[i, "seq"] <- paste(c(top.snp.stats[i, "REF"], top.snp.stats[i, "ALT_collapse"]), collapse="")
#if there is no alt allele, just put the ref allele in the seq column
} else {
top.snp.stats[i, "seq"] <- top.snp.stats[i, "REF"]
}
# make a consensus sequence with bma()
top.snp.stats$IUPAC[i] <- bma(unlist(strsplit(top.snp.stats$seq[i], split="")))
}
#capitalize the consensus
top.snp.stats$IUPAC <- toupper(top.snp.stats$IUPAC)
#add a bracket around the candidate SNP
top.snp.stats$IUPAC <- with(top.snp.stats, ifelse(!is.na(top.snp.stats$SNP_POS), paste0("[", IUPAC, "]"), IUPAC))
#fix and flag the indel sites
top.snp.stats$IUPAC <-with(top.snp.stats, ifelse(nchar(top.snp.stats$REF) != 1 , paste0("*(", REF, ")"), IUPAC))
#lowercase for low quality sites
top.snp.stats$IUPAC <- with(top.snp.stats, ifelse(top.snp.stats$DP_SUM_glaz < 30 | top.snp.stats$DP_SUM < 225, tolower(IUPAC), IUPAC))
write.csv(top.snp.stats, "top.snp.stats.IUPAC.csv")
consensus_seqlist = list() # initiate list
for (i in 1:length(top.candidates)) {
this.cand.name <- top.candidates[i]
this.cand  <- top.snp.stats[which(grepl(top.candidates[i],
top.snp.stats$true.cand)),]
this.cand <- this.cand[,c(1:6,101:102)]
this.cand.df <- data.frame("POS"=this.cand$POS,
"Range"=this.cand$Range,
"REF"=this.cand$REF,
"ALT"=this.cand$ALT,
"seq" = this.cand$seq,
"IUPAC" = this.cand$IUPAC)
consensus.seq <- paste(this.cand.df$IUPAC, collapse="")
consensus_seqlist[[i]] <- consensus.seq # add it to the main list
names(consensus_seqlist[[i]]) <- top.candidates[i]
}
folder <- "candidate_consensus_seqs/"
all.cand.seq.df <- data.frame(matrix(ncol = 2, nrow = 38))
names(all.cand.seq.df) <- c("candidate","consensus")
for (i in 1:length(consensus_seqlist)) {
#filepath <- paste(folder, names(consensus_seqlist[[i]]), '.txt', sep="")
#write.table(consensus_seqlist[[i]], filepath, sep="\n")
all.cand.seq.df[i,2] <- consensus_seqlist[[i]]
all.cand.seq.df[i,1] <- names(consensus_seqlist[[i]])
}
write.csv(all.cand.seq.df, "topcandidate.consensus.csv")
top.snp.stats[top.snp.stats$Range== 0, 1:6]
REF.ALT.list <- top.snp.stats[top.snp.stats$Range== 0, 1:6]
write.csv(REF.ALT.list, "ref.alt.list.csv")
setwd("/Users/serenwork/Desktop/Research/Glaziovii_introgression/KASP_design")
setwd("/Users/serenwork/Desktop/Research/Glaziovii_introgression/KASP_design")
snp.sub <- read.csv("Intertek_submission.csv")
head(snp.sub)
snp.sub$newseq <- NA
?str_replace()
snp.sub$newseq <- str_replace(snp.sub$Sequence., '[*]', snp.sub$SNP)
head(snp.sub$SNP)
snp.sub$SNP
head(snp.sub)
head(snp.sub$SNP.)
snp.sub$newseq <- str_replace(snp.sub$Sequence., '[*]', snp.sub$SNP.)
head(snp.sub$newseq)
str_replace(snp.sub$Sequence.[1], '[*]', snp.sub$SNP.[1])
str_replace(snp.sub$Sequence.[1], '[ %R% ANY_CHAR %R% ]', snp.sub$SNP.[1])
snp.sub$Sequence.[1]
str_replace(snp.sub$Sequence.[1], "[" %R% ANY_CHAR %R% "]", snp.sub$SNP.[1])
str_replace(snp.sub$Sequence.[1], '"[" %R% ANY_CHAR %R% "]"', snp.sub$SNP.[1])
str_replace(snp.sub$Sequence.[1], '\[ %R% ANY_CHAR %R% ]', snp.sub$SNP.[1])
str_replace(snp.sub$Sequence.[1], '\[', snp.sub$SNP.[1])
str_replace(snp.sub$Sequence.[1], '\\[', snp.sub$SNP.[1])
str_replace(snp.sub$Sequence.[1], '\\[*\\]', snp.sub$SNP.[1])
str_replace(snp.sub$Sequence.[1], '\\[ * \\]', snp.sub$SNP.[1])
str_replace(snp.sub$Sequence.[1], '\\[*\\]', snp.sub$SNP.[1])
str_replace(snp.sub$Sequence.[1], '*\\]', snp.sub$SNP.[1])
str_replace(snp.sub$Sequence.[1], '\\]', snp.sub$SNP.[1])
str_replace(snp.sub$Sequence.[1], '\\[.\\]', snp.sub$SNP.[1])
snp.sub$newseq <- str_replace(snp.sub$Sequence., '\\[.\\]', snp.sub$SNP.)
head(snp.sub$newseq)
snp.sub$newseq[6]
snp.sub$Sequence.[6]
write.csv(snp.sub, "reformatted_SNPs.csv")
